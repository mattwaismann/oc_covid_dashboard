y = "Test Positivity",
fill = "Tier") +
# tiers c(0,2,5,8,100)
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = 2,
alpha = .4, fill = colors[4])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 2, ymax = 5,
alpha = .4, fill = colors[1])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 5, ymax = 8,
alpha = .4, fill = colors[2])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 8, ymax = 25,
alpha = .4, fill = colors[3])+
theme_fivethirtyeight() +
ylim(c(0,25)) +
theme(axis.title = element_text(), text = element_text(family = "Verdana")) +
theme(legend.position = 'top')
pos_mini_df %>%
ggplot(aes(x=factor(week), y = positivity_for_week)) +
geom_col() +
labs(title = "Orange County test postivity by week",
subtitle = paste("updated: ", date),
x = "Week",
y = "Test Positivity",
fill = "Tier") +
# tiers c(0,2,5,8,100)
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = 2,
alpha = .4, fill = colors[4])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 2, ymax = 5,
alpha = .4, fill = colors[1])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 5, ymax = 8,
alpha = .4, fill = colors[2])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 8, ymax = 25,
alpha = .4, fill = colors[3])+
theme_fivethirtyeight() +
ylim(c(0,25)) +
theme(axis.title = element_text(), text = element_text(family = "Verdana")) +
theme(legend.position = 'top')
library(dplyr)
library(ggplot2)
library(zoo)
colors = c('#F58C0A','#F0240F','#BF28D7','#ECF20D')
pos_mini_df %>%
ggplot(aes(x=factor(week), y = positivity_for_week)) +
geom_col() +
labs(title = "Orange County test postivity by week",
subtitle = paste("updated: ", date),
x = "Week",
y = "Test Positivity",
fill = "Tier") +
# tiers c(0,2,5,8,100)
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = 2,
alpha = .4, fill = colors[4])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 2, ymax = 5,
alpha = .4, fill = colors[1])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 5, ymax = 8,
alpha = .4, fill = colors[2])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 8, ymax = 25,
alpha = .4, fill = colors[3])+
theme_fivethirtyeight() +
ylim(c(0,25)) +
theme(axis.title = element_text(), text = element_text(family = "Verdana")) +
theme(legend.position = 'top')
library(dplyr)
library(ggplot2)
library(zoo)
colors = c('#F58C0A','#F0240F','#BF28D7','#ECF20D')
pos_mini_df %>%
ggplot(aes(x=factor(week), y = positivity_for_week)) +
geom_col() +
labs(title = "Orange County test postivity by week",
subtitle = paste("updated: ", date),
x = "Week",
y = "Test Positivity",
fill = "Tier") +
# tiers c(0,2,5,8,100)
annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = 2,
alpha = .4, fill = colors[4])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 2, ymax = 5,
alpha = .4, fill = colors[1])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 5, ymax = 8,
alpha = .4, fill = colors[2])+
annotate("rect", xmin = 0, xmax = Inf, ymin = 8, ymax = 25,
alpha = .4, fill = colors[3])+
theme_fivethirtyeight() +
ylim(c(0,25)) +
theme(axis.title = element_text(), text = element_text(family = "Verdana")) +
theme(legend.position = 'top')
View(df)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(big_df)
View(blueprint_df)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
pos_mini_df
df$equity_index_for_week[which(df_mini_df$equity_index_for_week == 0)] <- NA
pos_mini_df$equity_index_for_week[which(pos_mini_df$equity_index_for_week == 0)] <- NA
pos_mini_df
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
#reading
datasets = c("case","death","blueprint", "main","hospicu","pcr")
for(i in 1:length(datasets)){
detail <- datasets[i]
assign(paste(detail,"_list", sep = ""),fromJSON(paste("covid_dataoccovid_",detail,"_csv.json",sep = "")))
}
#cleaning
blueprint_df <- blueprint_list$features$attributes
case_df <- case_list$features$attributes
death_df <- death_list$features$attributes
main_df <- main_list$features$attributes
hospicu_df <- hospicu_list$features$attributes
pcr_df <- pcr_list$features$attributes
names(case_df)[1] <- 'date'
#merging
#UPDATE NAS TO REMOVE
big_df = left_join(case_df,blueprint_df,by = c("date")) %>% left_join(y=death_df,by = c("date")) %>% left_join(y=main_df, by = c("date")) %>% left_join(y=hospicu_df, by = c("date"))%>% left_join(y = pcr_df, by = c("date"))
big_df <- big_df[-(386:405),]
#select  only relevant features
names(big_df)
relevant <- c('date','total_cases_repo','daily_cases_repo','daily_cases_spec','daily_7day_avg.x','daily_dth.x','dth_date','total_dth_date','daily_neg_spec','daily_pos_spec','daily_spec','tot_pcr_pos','cdph_tpp','daily_test_repo','daily_7day_avg.y','daily_case_rate','positive_rate','new_var','hospital','icu')
df <- big_df %>% select(relevant)
#adding dates
#UPDATE DATE BY 1
date_seq = seq(as.Date("2020/01/22"),as.Date(date), "days")
#Date
date = "02/09/2021"
#adding dates
#UPDATE DATE BY 1
date_seq = seq(as.Date("2020/01/22"),as.Date(date), "days")
#Date
date = "2021/02/09"
#adding dates
#UPDATE DATE BY 1
date_seq = seq(as.Date("2020/01/22"),as.Date(date), "days")
df$date <- date_seq
df %>% select('date','positive_rate')
non_missing_ind <- which(!is.na(df$positive_rate))
non_missing_ind
pos_week_ind <- seq(min(non_missing_ind)+1,length(df$positive_rate),7)
pos_week_ind
relevant_pos <- df$positive_rate[pos_week_ind]
relevant_case_rate <- df$daily_case_rate[pos_week_ind]
relevant_equity_index <- df$new_var[pos_week_ind]
pos_mini_df <- data.frame(week = 1:length(relevant_pos),positivity_for_week = relevant_pos, case_rate_for_week = relevant_case_rate, equity_index_for_week = relevant_equity_index)
pos_mini_df$equity_index_for_week[which(pos_mini_df$equity_index_for_week == 0)] <- NA
pos_mini_df
pos_mini_df
runApp()
library(plotly)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
fonts()
runApp()
runApp()
label <- list(bgcolor = "#232F34",
bordercolor = "transparent",
font = font)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
devtools::install_github("cmu-delphi/covidcast", ref = "main",
subdir = "R-packages/covidcast")
install.packages("devtools")
devtools::install_github("cmu-delphi/covidcast", ref = "main",
subdir = "R-packages/covidcast")
df <- covidcast_signal(data_source = "usa-facts",
signal = "confirmed_cumulative_prop",
start_day = "2020-12-31", end_day = "2020-12-31")
library(covidcast)
df <- covidcast_signal(data_source = "usa-facts",
signal = "confirmed_cumulative_prop",
start_day = "2020-12-31", end_day = "2020-12-31")
plot(df)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(pos_mini_df)
df %>% select('date','positive_rate')
non_missing_ind
pos_week_ind
pos_mini_df <- data.frame(start_week = relevant_date, df$date[pos_week_ind] week = 1:length(relevant_pos),positivity_for_week = relevant_pos, case_rate_for_week = relevant_case_rate, equity_index_for_week = relevant_equity_index)
relevant_date <- df$date[pos_week_ind]
n
pos_mini_df <- data.frame(start_week = relevant_date, df$date[pos_week_ind] week = 1:length(relevant_pos),positivity_for_week = relevant_pos, case_rate_for_week = relevant_case_rate, equity_index_for_week = relevant_equity_index)
pos_mini_df <- data.frame(start_week = relevant_date, week = 1:length(relevant_pos),positivity_for_week = relevant_pos, case_rate_for_week = relevant_case_rate, equity_index_for_week = relevant_equity_index)
pos_mini_df$start_week
pos_mini_df$start_week %>% class()
pos_mini_df$start_week -1
pos_mini_df$start_week + 6
pos_mini_df <- data.frame(start_week = relevant_date,end_week = relevant_date + 6, week = 1:length(relevant_pos),positivity_for_week = relevant_pos, case_rate_for_week = relevant_case_rate, equity_index_for_week = relevant_equity_index)
pos_mini_df$equity_index_for_week[which(pos_mini_df$equity_index_for_week == 0)] <- NA
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
relevant_date <- format(df$date[pos_week_ind], format = "%m-%d")
relevant_date
relevant_date +1
runApp()
runApp()
relevant_case_rate <- df$daily_case_rate[pos_week_ind]
relevant_equity_index <- df$new_var[pos_week_ind]
relevant_date <- df$date[pos_week_ind]
pos_mini_df <- data.frame(start_week =format(relevant_date, format = "%m/%d"),end_week = format(relevant_date +6, format = "%m/%d"), week = 1:length(relevant_pos),positivity_for_week = relevant_pos, case_rate_for_week = relevant_case_rate, equity_index_for_week = relevant_equity_index)
pos_mini_df$equity_index_for_week[which(pos_mini_df$equity_index_for_week == 0)] <- NA
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
body <- dashboardBody(
tabItems(
tabItem(tabName = "daily",
fluidRow(
infoBox("New cases", subtitle = paste("updated: ", today_date), df$daily_cases_repo %>% tail(1), color = "yellow", fill = T),
infoBox("New deaths", subtitle = paste("updated: ", today_date), df$daily_dth.x %>% tail(1), color = "yellow", fill = T )
),
fluidRow(
box(sliderInput("n_days",label = "Select a number of days", value = 60, min = 14, max = 365),
width = 4,
status = "primary"
)
),
fluidRow(
tabBox(
tabPanel("By reported date",
plotlyOutput("new_cases"),
),
tabPanel("By specimen collection date",
plotlyOutput("new_specimen")
)
),
tabBox(
tabPanel("By reported date",
plotlyOutput("new_deaths"),
),
tabPanel("By actual death date",
plotlyOutput("death_date")
)
)
),
fluidRow(
box(
plotlyOutput("hospicu"),
status = "primary"
),
box(
plotlyOutput("daily_spec"),
status = "primary"
)
)
),
tabItem(tabName = "metrics",
fluidRow(
infoBox("This week's positive test rate", subtitle = paste("updated: ", today_date), paste(pos_mini_df$positivity_for_week %>% tail(1),"%"), color = "yellow", fill = T),
infoBox("This week's adjusted case rate", subtitle = paste("updated: ", today_date), pos_mini_df$case_rate_for_week %>% tail(1), color = "yellow", fill = T),
infoBox("This week's Health Equity Index", subtitle = paste("updated: ", today_date), pos_mini_df$equity_index_for_week %>% tail(1), color = "yellow", fill = T),
),
fluidRow(
column(6, wellPanel(tags$h4("Tier Information"),"The state is now using three statistics to judge counties. With some exceptions, metrics must surpass the benchmark for the next tier in order to loosen restrictions. The latest numbers, along with tier reassignments, are released each Tuesday. The first is called the",strong("adjusted case rate"),". It takes new cases in a recent seven-day period — excluding cases at prisons and jails — and adjusts for population. In some areas, that number is modified to account for the volume of testing. Orange County's most recent adjusted case rate was", pos_mini_df$case_rate_for_week %>% tail(1),
"The second metric is the", strong("positive test rate"),", which is the percentage of tests for the virus that come back positive. Orange County's most recent positive test rate was",pos_mini_df$positivity_for_week %>% tail(1),"%.
The third metric measures whether positive tests in the most disadvantaged neighborhoods have significantly exceeded a county's overall rate — a disparity that's been widespread during the pandemic. The statistic is known as the", strong("Health Equity Index"),". Orange County’s most recent score is",pos_mini_df$equity_index_for_week %>% tail(1),"."
)
),
column(6, box(plotOutput("positivity"), status = TRUE)
)
),
fluidRow(
box(plotOutput("case_rate"),
status = "primary"
),
box(plotOutput("equity_index"),
status = "primary"
)
)
)
)
)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
